<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>3D Scatter Plot</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script
      type="text/javascript"
      src="http://x3dom.org/x3dom/dist/x3dom-full.js"
    ></script>
    <style>
      body {
        margin: auto;
        background-color: white;
      }
      div {
        backgroumd-color: white;
      }
      header {
        background-color: white;
      }

      /*
 * X3DOM JavaScript Library
 * http://www.x3dom.org
 *
 * (C)2009 Fraunhofer IGD, Darmstadt, Germany
 * Dual licensed under the MIT and GPL
 *
 * Based on code originally provided by
 * Philip Taylor: http://philip.html5.org
 */

      X3D,
      x3d {
        position: relative;
        cursor: pointer;
        margin: 0;
        padding: 0;
        outline: none;
        display: block;
      }

      X3D:hover,
      x3d:hover,
      .x3dom-canvas:hover {
        -webkit-user-select: none;
        -webkit-touch-callout: none;
      }

      .x3dom-canvas {
        border: none;
        cursor: pointer;
        cursor: -webkit-grab;
        cursor: grab;
        width: 100%;
        height: 100%;
      }

      .x3dom-canvas-mousedown {
        cursor: -webkit-grabbing;
        cursor: grabbing;
      }

      .x3dom-canvas:focus {
        outline: none;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .x3dom-vr {
        position: absolute;
        display: none;
        bottom: 5px;
        right: 15px;
        width: 48px;
        height: 48px;
        background-color: #ccc;
        opacity: 0.9;
        -webkit-mask-image: url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 24 24' style='enable-background:new 0 0 24 24;' xml:space='preserve'%3E%3Cpath id='XMLID_9_' style='fill:%23FFFFFF;' d='M20.2,6.1c-2.7,0-5.4,0-8.2,0c-2.8,0-5.5,0-8.3,0c-1,0-1.5,0.6-1.5,1.5 c0,2.8,0,5.6,0,8.5c0,0.9,0.6,1.5,1.5,1.5c1.7,0,3.3,0,5,0c0.6,0,0.9-0.2,1.1-0.8c0.3-0.8,0.7-1.7,1-2.5c0.2-0.6,0.6-0.9,1.2-0.9 c0.6,0,1,0.4,1.2,1c0.3,0.8,0.5,1.5,0.8,2.3c0.3,0.8,0.5,0.9,1.3,0.9c1.6,0,3.2,0,4.7,0c1.2,0,1.7-0.5,1.7-1.8c0-2.7,0-5.4,0-8 C21.8,6.6,21.4,6.1,20.2,6.1z M7.8,14.3c-1.2,0-2.2-0.9-2.2-2.1c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C10,13.3,9,14.3,7.8,14.3z M16.2,14.3c-1.2,0-2.2-1-2.2-2.2c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C18.4,13.4,17.4,14.3,16.2,14.3z'/%3E%3C/svg%3E");
        mask-image: url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 24 24' style='enable-background:new 0 0 24 24;' xml:space='preserve'%3E%3Cpath id='XMLID_9_' style='fill:%23FFFFFF;' d='M20.2,6.1c-2.7,0-5.4,0-8.2,0c-2.8,0-5.5,0-8.3,0c-1,0-1.5,0.6-1.5,1.5 c0,2.8,0,5.6,0,8.5c0,0.9,0.6,1.5,1.5,1.5c1.7,0,3.3,0,5,0c0.6,0,0.9-0.2,1.1-0.8c0.3-0.8,0.7-1.7,1-2.5c0.2-0.6,0.6-0.9,1.2-0.9 c0.6,0,1,0.4,1.2,1c0.3,0.8,0.5,1.5,0.8,2.3c0.3,0.8,0.5,0.9,1.3,0.9c1.6,0,3.2,0,4.7,0c1.2,0,1.7-0.5,1.7-1.8c0-2.7,0-5.4,0-8 C21.8,6.6,21.4,6.1,20.2,6.1z M7.8,14.3c-1.2,0-2.2-0.9-2.2-2.1c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C10,13.3,9,14.3,7.8,14.3z M16.2,14.3c-1.2,0-2.2-1-2.2-2.2c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C18.4,13.4,17.4,14.3,16.2,14.3z'/%3E%3C/svg%3E");
      }

      .x3dom-vr:hover {
        background-color: #999;
      }

      #x3dom-state-viewer {
        position: absolute;
        margin: 2px;
        padding: 5px;
        width: 135px;
        top: 0%;
        right: 0%;
        opacity: 0.9;
        background-color: #323232;
        z-index: 1000;
        font-family: Arial, sans-serif;
        color: #c8c8c8;
        font-weight: bold;
        text-transform: uppercase;
        cursor: help;
      }

      .x3dom-states-head {
        display: block;
        font-size: 26px;
      }

      .x3dom-states-rendermode-software {
        font-size: 10px;
        margin: 0 0 2px 2px;
      }

      .x3dom-states-rendermode-hardware {
        font-size: 10px;
        margin: 0 0 2px 2px;
      }

      .x3dom-states-head2 {
        font-size: 10px;
      }

      .x3dom-states-list {
        float: left;
        width: 100%;
        border-top: 1px solid #c8c8c8;
        list-style: none;
        font-size: 9px;
        line-height: 16px;
        margin: 0;
        padding: 0;
        padding-top: 2px;
      }

      .x3dom-states-item {
        width: 100%;
        float: left;
      }

      .x3dom-states-item-title {
        float: left;
        margin-left: 2px;
      }

      .x3dom-states-item-value {
        float: right;
        margin-right: 2px;
      }

      .x3dom-touch-marker {
        display: inline;
        padding: 5px;
        border-radius: 10px;
        position: absolute;
        font-family: Helvetica, sans-serif;
        line-height: 10px;
        font-size: 10px;
        color: darkorange;
        background: cornsilk;
        opacity: 0.6;
        border: 2px solid orange;
        z-index: 200;
      }

      .x3dom-log {
        position: absolute;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        border: 2px solid olivedrab;
        height: 200px;
        padding: 4px;
        overflow: auto;
        white-space: pre-wrap;
        font-family: sans-serif;
        font-size: x-small;
        color: #00ff00;
        background-color: black;
        opacity: 0.8;
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }

      .x3dom-nox3d {
        font-family: Helvetica, sans-serif;
        font-size: 14px;
        background-color: #eb7a7a;
        padding: 1em;
        opacity: 0.75;
      }

      .x3dom-nox3d p {
        color: #fff;
        font-size: 14px;
      }

      .x3dom-nox3d a {
        color: #fff;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <header></header>
    <div id="divPlot"></div>
    <script>
      var rows = [
        { x: 5.1, y: 3.5, z: 1.4, color: "setosa" },
        { x: 4.9, y: 3, z: 1.4, color: "setosa" },
        { x: 4.7, y: 3.2, z: 1.3, color: "setosa" },
        { x: 4.6, y: 3.1, z: 1.5, color: "setosa" },
        { x: 5, y: 3.6, z: 1.4, color: "setosa" },
        { x: 5.4, y: 3.9, z: 1.7, color: "setosa" },
        { x: 4.6, y: 3.4, z: 1.4, color: "setosa" },
        { x: 5, y: 3.4, z: 1.5, color: "setosa" },
        { x: 4.4, y: 2.9, z: 1.4, color: "setosa" },
        { x: 4.9, y: 3.1, z: 1.5, color: "setosa" },
        { x: 5.4, y: 3.7, z: 1.5, color: "setosa" },
        { x: 4.8, y: 3.4, z: 1.6, color: "setosa" },
        { x: 4.8, y: 3, z: 1.4, color: "setosa" },
        { x: 4.3, y: 3, z: 1.1, color: "setosa" },
        { x: 5.8, y: 4, z: 1.2, color: "setosa" },
        { x: 5.7, y: 4.4, z: 1.5, color: "setosa" },
        { x: 5.4, y: 3.9, z: 1.3, color: "setosa" },
        { x: 5.1, y: 3.5, z: 1.4, color: "setosa" },
        { x: 5.7, y: 3.8, z: 1.7, color: "setosa" },
        { x: 5.1, y: 3.8, z: 1.5, color: "setosa" },
        { x: 5.4, y: 3.4, z: 1.7, color: "setosa" },
        { x: 5.1, y: 3.7, z: 1.5, color: "setosa" },
        { x: 4.6, y: 3.6, z: 1, color: "setosa" },
        { x: 5.1, y: 3.3, z: 1.7, color: "setosa" },
        { x: 4.8, y: 3.4, z: 1.9, color: "setosa" },
        { x: 5, y: 3, z: 1.6, color: "setosa" },
        { x: 5, y: 3.4, z: 1.6, color: "setosa" },
        { x: 5.2, y: 3.5, z: 1.5, color: "setosa" },
        { x: 5.2, y: 3.4, z: 1.4, color: "setosa" },
        { x: 4.7, y: 3.2, z: 1.6, color: "setosa" },
        { x: 4.8, y: 3.1, z: 1.6, color: "setosa" },
        { x: 5.4, y: 3.4, z: 1.5, color: "setosa" },
        { x: 5.2, y: 4.1, z: 1.5, color: "setosa" },
        { x: 5.5, y: 4.2, z: 1.4, color: "setosa" },
        { x: 4.9, y: 3.1, z: 1.5, color: "setosa" },
        { x: 5, y: 3.2, z: 1.2, color: "setosa" },
        { x: 5.5, y: 3.5, z: 1.3, color: "setosa" },
        { x: 4.9, y: 3.6, z: 1.4, color: "setosa" },
        { x: 4.4, y: 3, z: 1.3, color: "setosa" },
        { x: 5.1, y: 3.4, z: 1.5, color: "setosa" },
        { x: 5, y: 3.5, z: 1.3, color: "setosa" },
        { x: 4.5, y: 2.3, z: 1.3, color: "setosa" },
        { x: 4.4, y: 3.2, z: 1.3, color: "setosa" },
        { x: 5, y: 3.5, z: 1.6, color: "setosa" },
        { x: 5.1, y: 3.8, z: 1.9, color: "setosa" },
        { x: 4.8, y: 3, z: 1.4, color: "setosa" },
        { x: 5.1, y: 3.8, z: 1.6, color: "setosa" },
        { x: 4.6, y: 3.2, z: 1.4, color: "setosa" },
        { x: 5.3, y: 3.7, z: 1.5, color: "setosa" },
        { x: 5, y: 3.3, z: 1.4, color: "setosa" },
        { x: 7, y: 3.2, z: 4.7, color: "versicolor" },
        { x: 6.4, y: 3.2, z: 4.5, color: "versicolor" },
        { x: 6.9, y: 3.1, z: 4.9, color: "versicolor" },
        { x: 5.5, y: 2.3, z: 4, color: "versicolor" },
        { x: 6.5, y: 2.8, z: 4.6, color: "versicolor" },
        { x: 5.7, y: 2.8, z: 4.5, color: "versicolor" },
        { x: 6.3, y: 3.3, z: 4.7, color: "versicolor" },
        { x: 4.9, y: 2.4, z: 3.3, color: "versicolor" },
        { x: 6.6, y: 2.9, z: 4.6, color: "versicolor" },
        { x: 5.2, y: 2.7, z: 3.9, color: "versicolor" },
        { x: 5, y: 2, z: 3.5, color: "versicolor" },
        { x: 5.9, y: 3, z: 4.2, color: "versicolor" },
        { x: 6, y: 2.2, z: 4, color: "versicolor" },
        { x: 6.1, y: 2.9, z: 4.7, color: "versicolor" },
        { x: 5.6, y: 2.9, z: 3.6, color: "versicolor" },
        { x: 6.7, y: 3.1, z: 4.4, color: "versicolor" },
        { x: 5.6, y: 3, z: 4.5, color: "versicolor" },
        { x: 5.8, y: 2.7, z: 4.1, color: "versicolor" },
        { x: 6.2, y: 2.2, z: 4.5, color: "versicolor" },
        { x: 5.6, y: 2.5, z: 3.9, color: "versicolor" },
        { x: 5.9, y: 3.2, z: 4.8, color: "versicolor" },
        { x: 6.1, y: 2.8, z: 4, color: "versicolor" },
        { x: 6.3, y: 2.5, z: 4.9, color: "versicolor" },
        { x: 6.1, y: 2.8, z: 4.7, color: "versicolor" },
        { x: 6.4, y: 2.9, z: 4.3, color: "versicolor" },
        { x: 6.6, y: 3, z: 4.4, color: "versicolor" },
        { x: 6.8, y: 2.8, z: 4.8, color: "versicolor" },
        { x: 6.7, y: 3, z: 5, color: "versicolor" },
        { x: 6, y: 2.9, z: 4.5, color: "versicolor" },
        { x: 5.7, y: 2.6, z: 3.5, color: "versicolor" },
        { x: 5.5, y: 2.4, z: 3.8, color: "versicolor" },
        { x: 5.5, y: 2.4, z: 3.7, color: "versicolor" },
        { x: 5.8, y: 2.7, z: 3.9, color: "versicolor" },
        { x: 6, y: 2.7, z: 5.1, color: "versicolor" },
        { x: 5.4, y: 3, z: 4.5, color: "versicolor" },
        { x: 6, y: 3.4, z: 4.5, color: "versicolor" },
        { x: 6.7, y: 3.1, z: 4.7, color: "versicolor" },
        { x: 6.3, y: 2.3, z: 4.4, color: "versicolor" },
        { x: 5.6, y: 3, z: 4.1, color: "versicolor" },
        { x: 5.5, y: 2.5, z: 4, color: "versicolor" },
        { x: 5.5, y: 2.6, z: 4.4, color: "versicolor" },
        { x: 6.1, y: 3, z: 4.6, color: "versicolor" },
        { x: 5.8, y: 2.6, z: 4, color: "versicolor" },
        { x: 5, y: 2.3, z: 3.3, color: "versicolor" },
        { x: 5.6, y: 2.7, z: 4.2, color: "versicolor" },
        { x: 5.7, y: 3, z: 4.2, color: "versicolor" },
        { x: 5.7, y: 2.9, z: 4.2, color: "versicolor" },
        { x: 6.2, y: 2.9, z: 4.3, color: "versicolor" },
        { x: 5.1, y: 2.5, z: 3, color: "versicolor" },
        { x: 5.7, y: 2.8, z: 4.1, color: "versicolor" },
        { x: 6.3, y: 3.3, z: 6, color: "virginica" },
        { x: 5.8, y: 2.7, z: 5.1, color: "virginica" },
        { x: 7.1, y: 3, z: 5.9, color: "virginica" },
        { x: 6.3, y: 2.9, z: 5.6, color: "virginica" },
        { x: 6.5, y: 3, z: 5.8, color: "virginica" },
        { x: 7.6, y: 3, z: 6.6, color: "virginica" },
        { x: 4.9, y: 2.5, z: 4.5, color: "virginica" },
        { x: 7.3, y: 2.9, z: 6.3, color: "virginica" },
        { x: 6.7, y: 2.5, z: 5.8, color: "virginica" },
        { x: 7.2, y: 3.6, z: 6.1, color: "virginica" },
        { x: 6.5, y: 3.2, z: 5.1, color: "virginica" },
        { x: 6.4, y: 2.7, z: 5.3, color: "virginica" },
        { x: 6.8, y: 3, z: 5.5, color: "virginica" },
        { x: 5.7, y: 2.5, z: 5, color: "virginica" },
        { x: 5.8, y: 2.8, z: 5.1, color: "virginica" },
        { x: 6.4, y: 3.2, z: 5.3, color: "virginica" },
        { x: 6.5, y: 3, z: 5.5, color: "virginica" },
        { x: 7.7, y: 3.8, z: 6.7, color: "virginica" },
        { x: 7.7, y: 2.6, z: 6.9, color: "virginica" },
        { x: 6, y: 2.2, z: 5, color: "virginica" },
        { x: 6.9, y: 3.2, z: 5.7, color: "virginica" },
        { x: 5.6, y: 2.8, z: 4.9, color: "virginica" },
        { x: 7.7, y: 2.8, z: 6.7, color: "virginica" },
        { x: 6.3, y: 2.7, z: 4.9, color: "virginica" },
        { x: 6.7, y: 3.3, z: 5.7, color: "virginica" },
        { x: 7.2, y: 3.2, z: 6, color: "virginica" },
        { x: 6.2, y: 2.8, z: 4.8, color: "virginica" },
        { x: 6.1, y: 3, z: 4.9, color: "virginica" },
        { x: 6.4, y: 2.8, z: 5.6, color: "virginica" },
        { x: 7.2, y: 3, z: 5.8, color: "virginica" },
        { x: 7.4, y: 2.8, z: 6.1, color: "virginica" },
        { x: 7.9, y: 3.8, z: 6.4, color: "virginica" },
        { x: 6.4, y: 2.8, z: 5.6, color: "virginica" },
        { x: 6.3, y: 2.8, z: 5.1, color: "virginica" },
        { x: 6.1, y: 2.6, z: 5.6, color: "virginica" },
        { x: 7.7, y: 3, z: 6.1, color: "virginica" },
        { x: 6.3, y: 3.4, z: 5.6, color: "virginica" },
        { x: 6.4, y: 3.1, z: 5.5, color: "virginica" },
        { x: 6, y: 3, z: 4.8, color: "virginica" },
        { x: 6.9, y: 3.1, z: 5.4, color: "virginica" },
        { x: 6.7, y: 3.1, z: 5.6, color: "virginica" },
        { x: 6.9, y: 3.1, z: 5.1, color: "virginica" },
        { x: 5.8, y: 2.7, z: 5.1, color: "virginica" },
        { x: 6.8, y: 3.2, z: 5.9, color: "virginica" },
        { x: 6.7, y: 3.3, z: 5.7, color: "virginica" },
        { x: 6.7, y: 3, z: 5.2, color: "virginica" },
        { x: 6.3, y: 2.5, z: 5, color: "virginica" },
        { x: 6.5, y: 3, z: 5.2, color: "virginica" },
        { x: 6.2, y: 3.4, z: 5.4, color: "virginica" },
        { x: 5.9, y: 3, z: 5.1, color: "virginica" },
      ];

      d3.select("html").style("height", "100%").style("width", "100%");
      d3.select("body").style("height", "100%").style("width", "100%");
      d3.select("#divPlot").style("width", "100%").style("height", "100%");

      var x3d = d3
        .select("#divPlot")
        .append("x3d")
        .style("width", "100%")
        .style("height", "100%")
        .style("border", "none");

      var scene = x3d.append("scene");

      scene
        .append("orthoviewpoint")
        .attr("centerOfRotation", [0, 0, 0])
        .attr("fieldOfView", [-9, -17, 17, 17])
        .attr("orientation", [-0.5, 1, 0.2, (1.12 * Math.PI) / 4])
        .attr("position", [12, 10, 10]);

      //  var rows = initializeDataGrid();
      var axisRange = [0, 12];
      var scales = [];
      var initialDuration = 0;
      var defaultDuration = 800;
      var ease = "linear";
      var time = 0;
      var axisKeys = ["x", "y", "z"];

      // Helper functions for initializeAxis() and drawAxis()
      function axisName(name, axisIndex) {
        return ["x", "y", "z"][axisIndex] + name;
      }

      function constVecWithAxisValue(otherValue, axisValue, axisIndex) {
        var result = [otherValue, otherValue, otherValue];
        result[axisIndex] = axisValue;
        return result;
      }

      // Used to make 2d elements visible
      function makeSolid(selection, color) {
        selection
          .append("appearance")
          .append("material")
          .attr("diffuseColor", color || "black");
        return selection;
      }

      // Initialize the axes lines and labels.
      function initializePlot() {
        initializeAxis(0);
        initializeAxis(1);
        initializeAxis(2);
      }

      function initializeAxis(axisIndex) {
        var key = axisKeys[axisIndex];
        drawAxis(axisIndex, key, initialDuration);

        var scaleMin = axisRange[0];
        var scaleMax = axisRange[1];

        // the axis line
        var newAxisLine = scene
          .append("transform")
          .attr("class", axisName("Axis", axisIndex))
          .attr(
            "rotation",
            [
              [0, 0, 0, 0],
              [0, 0, 1, Math.PI / 2],
              [0, 1, 0, -Math.PI / 2],
            ][axisIndex]
          )
          .append("shape");
        newAxisLine
          .append("appearance")
          .append("material")
          .attr("emissiveColor", "black");
        newAxisLine
          .append("polyline2d")
          // Line drawn along y axis does not render in Firefox, so draw one
          // along the x axis instead and rotate it (above).
          .attr("lineSegments", "0 0," + scaleMax + " 0");

        // axis labels
        var newAxisLabel = scene
          .append("transform")
          .attr("class", axisName("AxisLabel", axisIndex))
          .attr(
            "translation",
            constVecWithAxisValue(
              0,
              scaleMin + 1.1 * (scaleMax - scaleMin),
              axisIndex
            )
          );

        var newAxisLabelShape = newAxisLabel
          .append("billboard")
          .attr("axisOfRotation", "0 0 0") // face viewer
          .append("shape")
          .call(makeSolid);

        var labelFontSize = 0.6;

        newAxisLabelShape
          .append("text")
          .attr("class", axisName("AxisLabelText", axisIndex))
          .attr("solid", "true")
          .attr("string", key)
          .append("fontstyle")
          .attr("size", labelFontSize)
          .attr("family", "Helvetica")
          .attr("justify", "END MIDDLE");
      }

      // Assign key to axis, creating or updating its ticks, grid lines, and labels.
      var cirColor = d3.scale.category10();

      function drawAxis(axisIndex, key, duration) {
        var scale = d3.scale
          .linear()
          .domain([1, 100]) // sets the axis tick labels
          .range(axisRange);

        var xScale = d3.scale
          .linear()
          .domain([1, 10]) // demo data range
          .range(axisRange);

        var yScale = d3.scale
          .linear()
          .domain([1, 8]) // demo data range
          .range(axisRange);

        var zScale = d3.scale
          .linear()
          .domain([1, 8]) // demo data range
          .range(axisRange);

        scales[0] = xScale;
        scales[1] = yScale;
        scales[2] = zScale;

        var numTicks = 5;
        var tickSize = 0.1;
        var tickFontSize = 0.5;

        // ticks along each axis
        var ticks = scene
          .selectAll("." + axisName("Tick", axisIndex))
          .data(scale.ticks(numTicks));
        var newTicks = ticks
          .enter()
          .append("transform")
          .attr("class", axisName("Tick", axisIndex));
        newTicks
          .append("shape")
          .call(makeSolid)
          .append("box")
          .attr("size", tickSize + " " + tickSize + " " + tickSize);
        // enter + update
        ticks
          .transition()
          .duration(duration)
          .attr("translation", function (tick) {
            return constVecWithAxisValue(0, scale(tick), axisIndex);
          });
        ticks.exit().remove();

        // tick labels
        var tickLabels = ticks
          .selectAll("billboard shape text")
          .data(function (d) {
            return [d];
          });
        var newTickLabels = tickLabels
          .enter()
          .append("billboard")
          .attr("axisOfRotation", "0 0 0")
          .append("shape")
          .call(makeSolid);
        newTickLabels
          .append("text")
          .attr("string", scale.tickFormat(10))
          .attr("solid", "true")
          .append("fontstyle")
          .attr("size", tickFontSize)
          .attr("family", "Helvetica")
          .attr("shape-rendering", "crispEdges")
          .attr("justify", "END MIDDLE");
        tickLabels // enter + update
          .attr("string", scale.tickFormat(10));
        tickLabels.exit().remove();

        // base grid lines
        if (axisIndex == 0 || axisIndex == 2) {
          var gridLines = scene
            .selectAll("." + axisName("GridLine", axisIndex))
            .data(scale.ticks(numTicks));
          gridLines.exit().remove();

          gridLines
            .selectAll("shape polyline2d")
            .transition()
            .duration(duration)
            .attr("lineSegments", "0 0, " + axisRange[1] + " 0");

          gridLines
            .transition()
            .duration(duration)
            .attr(
              "translation",
              axisIndex == 0
                ? function (d) {
                    return scale(d) + " 0 0";
                  }
                : function (d) {
                    return "0 0 " + scale(d);
                  }
            );
        }
      }

      // Update the data points (spheres) and stems.
      function plotData(duration) {
        if (!rows) {
          console.log("no rows to plot.");
          return;
        }

        var x = scales[0],
          y = scales[1],
          z = scales[2];
        var sphereRadius = .08;

        // Draw a sphere at each x,y,z coordinate.
        var datapoints = scene.selectAll(".datapoint").data(rows);
        datapoints.exit().remove();

        var newDatapoints = datapoints
          .enter()
          .append("transform")
          .attr("class", "datapoint")
          .attr("scale", [sphereRadius, sphereRadius, sphereRadius])
          .append("shape");
        newDatapoints.append("appearance").append("material");
        newDatapoints.append("sphere");
        // Does not work on Chrome; use transform instead
        //.attr("radius", sphereRadius)

        datapoints
          .selectAll("shape appearance material")
          //     .attr("diffuseColor", "black")
          .attr("diffuseColor", function (rows) {
            return cirColor(rows.color);
          })
          .append("title")
          .text(function (rows) {
            return rows.color;
          });

        datapoints
          .transition()
          .ease(ease)
          .duration(duration)
          .attr("translation", function (row) {
            return (
              x(row[axisKeys[0]]) +
              " " +
              y(row[axisKeys[1]]) +
              " " +
              z(row[axisKeys[2]])
            );
          });

        // Draw a stem from the x-z plane to each sphere at elevation y.
        // This convention was chosen to be consistent with x3d primitive ElevationGrid.
        var stems = scene.selectAll(".stem").data(rows);
        stems.exit().remove();

        var newStems = stems
          .enter()
          .append("transform")
          .attr("class", "stem")
          .append("shape");
        newStems
          .append("appearance")
          .append("material")
          .attr("emissiveColor", none);
        newStems.append("polyline2d").attr("lineSegments", function (row) {
          return "0 1, 0 0";
        });

        stems
          .transition()
          .ease(ease)
          .duration(duration)
          .attr("translation", function (row) {
            return x(row[axisKeys[0]]) + " 0 " + z(row[axisKeys[2]]);
          })
          .attr("scale", function (row) {
            return [1, y(row[axisKeys[1]])];
          });
      }

      // initializeDataGrid();
      initializePlot();
      plotData(defaultDuration);
      //   setInterval(plotData(defaultDuration), defaultDuration);
    </script>
  </body>
</html>
